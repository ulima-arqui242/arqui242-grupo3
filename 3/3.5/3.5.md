# 3.5. Elección de Tecnología


## EDT para Gestión de Reservas

### Contexto
El módulo de **Gestión de Reservas** en spas para la plataforma InStudio debe manejar citas de clientes en tiempo real, asegurando que una hora reservada no esté disponible para otros usuarios simultáneamente. Además, debe gestionar reservas concurrentes, ofreciendo confirmaciones rápidas y notificaciones en caso de cambios o cancelaciones. El sistema debe ser escalable, flexible y fácil de integrar con la arquitectura existente.

### 1 Titulo: Gestión de Reservas óptimo

La plataforma necesita manejar múltiples solicitudes de reserva concurrentes y garantizar la consistencia de los datos. Esto incluye prevenir reservas dobles para el mismo horario y gestionar cambios en la disponibilidad.

#### Alternativas

##### 1.1 AWS SQS + MongoDB

- **Ventajas:**
  - **AWS SQS**:
    - **Procesamiento distribuido de mensajes**: AWS SQS gestiona mensajes distribuidos, asegurando que las solicitudes de reserva se procesen en el orden correcto sin sobrecargar el sistema.
    - **Escalabilidad automática**: Escala automáticamente según la carga de mensajes, lo que permite manejar grandes volúmenes de reservas sin interrupciones.
    - **Integración con AWS Lambda y DynamoDB**: Permite una arquitectura basada en eventos para gestionar las confirmaciones y cancelaciones de reserva, así como integraciones con otros servicios de AWS.

  - **MongoDB**:
    - **Flexibilidad en el modelo de datos**: MongoDB permite almacenar reservas en un formato flexible, adaptándose a la evolución del sistema.
    - **Transacciones ACID**: Asegura que las operaciones de reserva sean consistentes y que no haya conflictos en reservas concurrentes.
    - **Escalabilidad horizontal**: MongoDB soporta particionamiento (sharding), lo que permite gestionar grandes volúmenes de datos.

- **Desventajas:**
  - **AWS SQS**:
    - **Procesamiento eventual**: La entrega de mensajes es fiable, pero puede haber retrasos en el procesamiento de las reservas, lo que podría afectar la experiencia del usuario.
    - **Costo acumulado por mensaje**: Aunque el costo por mensaje es bajo, puede acumularse con un alto volumen de tráfico.

  - **MongoDB**:
    - **Gestión adicional de lógica de concurrencia**: Aunque MongoDB ofrece transacciones, el manejo preciso de concurrencia y la prevención de reservas duplicadas puede requerir lógica adicional en la aplicación.
    - **Costo en infraestructuras grandes**: Escalar MongoDB puede resultar costoso a medida que aumenta la necesidad de potencia y almacenamiento.

##### 1.2 RabbitMQ + PostgreSQL

- **Ventajas:**
  - **RabbitMQ**:
    - **Alta confiabilidad en la entrega de mensajes**: RabbitMQ ofrece una entrega de mensajes rápida y confiable, adecuada para gestionar solicitudes de reserva en tiempo real.
    - **Control de concurrencia**: Permite el manejo de múltiples consumidores con mensajes distribuidos, asegurando que cada solicitud de reserva sea atendida sin conflicto.
    - **Soporte para múltiples patrones de mensajería**: RabbitMQ soporta patrones de comunicación como publicación/suscripción, útil para notificaciones de cambios o cancelaciones.

  - **PostgreSQL**:
    - **Transacciones ACID**: PostgreSQL asegura consistencia en las operaciones de reserva, evitando que ocurran reservas duplicadas.
    - **Modelo relacional sólido**: Facilita la ejecución de consultas complejas sobre disponibilidad y reservas, gestionando relaciones entre usuarios, horarios y servicios.
    - **Ampliabilidad con extensiones**: PostgreSQL ofrece extensiones como TimescaleDB para optimizar la gestión de datos temporales, útil para manejar calendarios y horarios en las reservas.

- **Desventajas:**
  - **RabbitMQ**:
    - **Mantenimiento manual**: RabbitMQ requiere más configuración y monitoreo en comparación con AWS SQS, lo que puede aumentar la carga operativa.
    - **Escalabilidad más compleja**: Aunque RabbitMQ puede escalar, requiere una infraestructura más compleja que la escalabilidad automática de SQS.

  - **PostgreSQL**:
    - **Escalabilidad limitada**: A diferencia de las bases de datos NoSQL, PostgreSQL tiene limitaciones en cuanto a escalabilidad horizontal.
    - **Modelo de datos más rígido**: PostgreSQL requiere un esquema fijo, lo que puede dificultar cambios rápidos en la estructura de las reservas.

##### 1.3 Apache Kafka + Cassandra

- **Ventajas:**
  - **Apache Kafka**:
    - **Procesamiento de eventos en tiempo real**: Kafka es ideal para manejar grandes flujos de datos y eventos en tiempo real, garantizando un alto rendimiento en el procesamiento de reservas concurrentes.
    - **Alto rendimiento**: Kafka maneja millones de mensajes por segundo, lo que es adecuado para plataformas con alta concurrencia de usuarios.
    - **Garantía de entrega**: Kafka asegura que los mensajes se entreguen una vez, incluso en escenarios de alta carga o fallos en la red.

  - **Cassandra**:
    - **Escalabilidad masiva**: Cassandra está diseñada para escalar horizontalmente sin afectar el rendimiento, lo que permite gestionar grandes volúmenes de datos distribuidos en múltiples nodos.
    - **Alta disponibilidad**: Al ser una base de datos distribuida, Cassandra ofrece una alta disponibilidad y tolerancia a fallos, asegurando que el sistema de reservas esté siempre en funcionamiento.

- **Desventajas:**
  - **Apache Kafka**:
    - **Complejidad operativa**: Kafka requiere un equipo experimentado para su configuración, monitoreo y mantenimiento, lo que puede ser una barrera para equipos pequeños.
    - **Consumo de recursos**: Kafka consume muchos recursos en términos de almacenamiento y procesamiento, lo que puede aumentar los costos operativos.

  - **Cassandra**:
    - **Modelo de datos limitado**: Cassandra no soporta consultas complejas como las bases de datos relacionales, lo que puede dificultar ciertos casos de uso.
    - **Costo elevado de infraestructura**: Al ser altamente escalable, Cassandra puede volverse costosa en implementaciones a gran escala.

### 2. Criterios de Elección

- **Escalabilidad**: La capacidad del sistema para manejar múltiples solicitudes concurrentes de reserva es crucial.
- **Consistencia**: Es vital garantizar que las reservas sean consistentes y que no haya reservas duplicadas.
- **Integración**: La solución debe integrarse fácilmente con la arquitectura existente de InStudio.
- **Costo**: El costo de operación a largo plazo es un factor determinante, especialmente con un alto volumen de usuarios.

### 3. Decisión

Se elige **AWS SQS + MongoDB** como la combinación tecnológica preferida para la Gestión de Reservas.

### 4. Sustento

La combinación de **AWS SQS + MongoDB** es la más adecuada debido a su **escalabilidad automática** y **flexibilidad en el manejo de datos**. SQS permite gestionar la concurrencia y el procesamiento distribuido de las solicitudes de reserva, mientras que MongoDB proporciona un modelo de datos flexible y transacciones ACID para asegurar la consistencia de las reservas. Además, la integración con otros servicios de AWS simplifica el mantenimiento y escalabilidad a largo plazo.


## EDT para Módulo de Notificaciones

### Contexto

EL módulo de notificaciones está diseñado para brindarle a los usuarios que son clientes de salones de belleza notificaciones (sean por correo o en la misma página web) de promociones, ofertas y recordatorios de citas. Dado que InStudio tiene una variedad de tipos de notificaciones, donde el contenido de cada una va diferir de la otra se ha optado por emplear un modelo de base datos NoSQL de clave valor.

### 1 Titulo: Almacenamiento de notificaciones

El almacenamiento de las notificaciones para poder enviar la información debe ser de rápido acceso y modificación. Con la opción de poder ampliar nuevos campos de ser necesario en caso se necesite. Además de tener una fácil incorporación a la plataforma que usaremos para desplegar la aplicación.

#### Alternativas

##### 1.1 Redis

- **Ventajas**:

- Baja latencia: Es una base de datos en memoria, lo que permite lecturas y escrituras rápidas, ideal para aplicaciones en tiempo real como caché, colas de mensajes o sesiones de usuario.
- Tipos de datos avanzados: Además de pares clave-valor simples, Redis soporta estructuras de datos complejas como listas, conjuntos, mapas y hashes, lo que lo hace versátil para diferentes tipos de aplicaciones.
- Escalabilidad: Redis permite escalado horizontal con Redis Cluster, ofreciendo alta disponibilidad y particionamiento de datos.
- Persistencia opcional: Redis es principalmente una base de datos en memoria, pero también soporta la persistencia de datos a disco si es necesario.

- **Desventajas:**

- Limitado por la memoria: Como Redis guarda los datos en RAM, el tamaño de los datos está limitado por la cantidad de memoria disponible, lo que puede volverse costoso si se manejan grandes volúmenes de datos.
- Operaciones distribuidas: Aunque Redis Cluster soporta operaciones distribuidas, las operaciones multi-clave en diferentes nodos pueden ser complejas y no siempre son consistentes.
- Si maneja de datos grandes, aumenta el costo.

##### 1.2 DynamoDB

- **Ventajas:**

- Totalmente gestionado: Es gestionado por AWS.
- Tiene Escalabilidad automática
- Costo por uso
- Alta disponibilidad y durabilidad por almacenar de manera distribuida la información.
- Integración con otros servicios AWS: Se integra fácilmente con otros servicios como Lambda, SNS,S3, y Kinesis.

- **Desventajas:**

- Modelo de datos limitado porque principalmente es clave valor
- Costo a largo plazo si hay un volumen alto de lectura y escritura
- Latencia mayor que Redis, pues Redis es en emmoria y dynamoDB es distruibuido

#### Criterios de Elección

- Costo 
- Escalabilidad 
- Facilidad de integración 

#### Decisión

Se elige **DynamoDB**

#### Sustento

Debido a que no se tiene que realizar mantenimiento, el costo puede ser solucionado implementando tiempo de vida de los registros según la naturaleza de las notificaciones y que pertence AWS, su integración con Amazon SNS ha de ser más sencilla que la que sería con Redis. Por lo que, emplearla permitiría un mejor desarrollo

## EDT para el módulo de Analíticas y Reporte

### Contexto

El módulo de analíticas y reporte, está diseñado para otorgar una visión amplia del rendimiento de cada salón de belleza en la plataforma InStudio, enfocado en aquellos bien o medianamente establecidos en el mercado. Las funcionalidades de este módulo están disponibles mediante la adquisición del plan organizativo. Este módulo se encarga de recopilar y almacenar métricas y datos que muestren el rendimiento de un salón, como cantidad reservas, reservas canceladas, entre otros, serán disponibles mediante un dashboard. Además de posibilitar la opción de generar reportes para un análisis más exhaustivo. El sistema manejará un gran volumen de datos en tiempo real por lo que se debe asegurar un alto rendimiento.

### 1 Titulo: Computación de métricas

Es necesario implementar un servicio que realice el cómputo de la función encargada de obtener y almacenar las métricas que se mostrarán en el dashboard del cliente. Por esta razón, se busca seleccionar opciones que permitan la ejecución de funciones bajo demanda, facilitando la escalabilidad y optimizando los costos.

#### Alternativas

#### 1.1 Stored Procedure en PostgreSQL - RDS

- **Ventajas**:
  - Procesamiento en la base de datos optimizando la latencia.
  - Mantenimiento centralizado: Facilita la gestión de la lógica y evita tener que desplegar nuevos servicios.

 - **Desventajas**:

   - Dependencia de la base de datos y potenciales cuellos de botella.
   - Complejidad de gestión a medida que crece la lógica.

#### 1.2 AWS Lambda + S3 + DuckDB

- **Ventajas**:
  - Escalabilidad automática y costo por uso.
  - DuckDB permite consultas analíticas eficientes directamente sobre archivos Parquet en S3.
  - Integración nativa con servicios de AWS y alta capacidad para manejar grandes volúmenes de datos.

- **Desventajas**:
  - Mayor esfuerzo inicial de integración y configuración.

#### Criterios de Elección

- Costo
- Requerimientos del negocio
- Escalabilidad
- Facilidad de integración

#### Decisión

Se elige AWS Lambda + S3 + DuckDB.

#### Sustento

La combinación de AWS Lambda, S3 y DuckDB permite un sistema flexible y escalable, capaz de manejar grandes volúmenes de datos de reservas en tiempo real. DuckDB permite realizar consultas directamente sobre los archivos Parquet almacenados en S3, optimizando el análisis de datos para generar reportes sin necesidad de una base de datos tradicional.

## EDT para el módulo de Ofertas

### Contexto
El módulo de ofertas de InStudio permite a los salones de belleza crear y gestionar promociones dinámicas, como llevar uno gratis (ej. 2x1), descuentos por porcentaje, por monto de dinero, etc. Dado que el tipo de oferta y los detalles de cada una pueden variar, se está evaluando la mejor opción de base de datos para almacenar estas ofertas. Lo que se necesita es solución flexible, que permita un fácil ajuste a nuevas promociones y campos, con rendimiento adecuado para consultas dinámicas y rápidas modificaciones. Para ello se va a comparar un modelo SQL(PostgreSQL) y uno NoSQL (MongoDB) para determinar cuál es la mejor opción para este módulo.

### 1 Titulo: Almacenamiento de ofertas
El almacenamiento de las ofertas requiere ser lo suficientemente flexible como para manejar diferentes tipos de promociones, lo que puede implicar múltiples campos y estructuras de datos, dependiendo del tipo de oferta. Además, debe ofrecer un acceso eficiente y poder añadir facilmente nuevas propiedades sin migraciones o modificaciones complejas.

#### Alternativas

#### 1.1 PostgreSQL (SQL)

- **Ventajas**:
  - Al ser un modelo relacional garantiza la consistencia de los datos.
  - Los modelos SQL ofrecen capacidades avanzadas para realizar consultas complejas con JOINs, agregaciones y funciones de ventana, que permiten análisis detallados de las ofertas sin necesidad de mover los datos a otro sistema.

- **Desventajas**:
  - Manejar diferentes tipos de ofertas puede llevar a modelos de datos complejos si cada tipo tiene un conjunto diferente de detalles y se tendrían que realizar consultas más sofisticadas para gestionar esta variabilidad.
  - PostgreSQL no es tan fácil de escalar horizontalmente como una base de datos NoSQL como MongoDB.

#### 1.2 MongoDB (NoSQL)

- **Ventajas**:
  - MongoDB permite almacenar documentos con diferentes estructuras dentro de la misma colección.
  - MongoDB se escala fácilmente de manera horizontal, lo que permite gestionar grandes volúmenes de datos de manera más eficiente en aplicaciones distribuidas.
  - MongoDB almacena los datos en un formato BSON (una forma binaria de JSON), lo que facilita la integración con aplicaciones web que usualmente ya manejan datos en formato JSON.

- **Desventajas**:
  - Aunque MongoDB soporta transacciones ACID, su rendimiento en operaciones transaccionales complejas no es tan eficiente como en bases de datos relacionales como PostgreSQL.
  - No es ideal para realizar consultas relacionales complejas.
  - La flexibilidad del esquema puede volverse un problema si no se manejan correctamente las validaciones de los datos a nivel de aplicación

#### Criterios de Elección

- Flexibilidad
- Escalabilidad
- Mantenibilidad

#### Decisión

Se elige MongoDB como la base de datos para el módulo de ofertas.

#### Sustento

Se elige MongoDB debido a su flexibilidad para manejar estructuras de datos variables, como las diferentes configuraciones de ofertas (descuentos, combos, etc.), sin la necesidad de realizar migraciones de esquema, lo que garantiza una mayor mantenibilidad a largo plazo. Además, un modelo NoSQL permite una escalabilidad horizontal más eficiente, lo cual es ideal para manejar un crecimiento en el volumen de datos. Al ser una base de datos orientada a documentos, también proporciona un rendimiento adecuado para lecturas y escrituras rápidas, esenciales para un sistema que debe acceder y mostrar ofertas de forma dinámica y en tiempo real.
